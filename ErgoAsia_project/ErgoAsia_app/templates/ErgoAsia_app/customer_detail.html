<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Customer Detail</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <!-- List.js CSS -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/list.js/2.3.1/list.min.css"
    />
    <!-- Custom CSS for additional styling -->
    <style>
      /* Custom styles */
      body {
        background-color: #f8f9fa; /* Light grey background for body */
      }
      .card {
        border: none; /* Remove border from card */
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.1); /* Add subtle shadow to card */
      }
      .card-header {
        background-color: #4e73df; /* Dark blue background for card header */
        color: #ffffff; /* White text color for card header */
        padding: 1rem 2rem; /* Padding for header */
        border-bottom: 2px solid #2e59d9; /* Darker border bottom */
      }
      .card-body {
        background-color: #ffffff; /* White background for card body */
        border-bottom: 2px solid #dee2e6; /* Light border bottom */
      }
      .table {
        margin-bottom: 0; /* Remove default bottom margin from table */
      }
      .table th {
        font-weight: 600; /* Bold font for table headers */
      }
      .table th,
      .table td {
        vertical-align: middle; /* Center content vertically in table cells */
      }
      .table tbody tr:nth-child(even) {
        background-color: #f8f9fa; /* Alternate row background color */
      }
      .btn-primary {
        background-color: #4e73df; /* Dark blue button background color */
        border-color: #4e73df; /* Dark blue button border color */
      }
      .btn-primary:hover {
        background-color: #2e59d9; /* Darker blue on hover */
        border-color: #2e59d9; /* Darker blue border on hover */
      }
    </style>
  </head>
  <body>
    <div class="container py-4">
      <div class="card mb-4">
        <div class="card-header">
          <h3 class="mb-0">{{ customer.name }}</h3>
          <p class="mb-0">
            <strong>Customer ID:</strong> {{ customer.customer_id }}
          </p>
        </div>
        <div class="card-body">
          <p class="mb-1"><strong>Email:</strong> {{ customer.email }}</p>
          <p class="mb-1"><strong>Phone:</strong> {{ customer.phno }}</p>
          <p class="mb-0"><strong>Address:</strong> {{ customer.address }}</p>
        </div>
      </div>

      <h4 class="mb-4">Customer Requirements</h4>
      <input
        type="text"
        id="searchInput"
        class="search form-control mb-3"
        placeholder="Search..."
      />

      <button class="btn btn-primary mb-3" id="newOrderBtn">New Order</button>
      <button
        class="btn btn-secondary mb-3"
        id="cancelBtn"
        style="display: none"
      >
        Cancel
      </button>

      <div id="orderForm" style="display: none; margin-bottom: 20px">
        <form
          id="orderFormElement"
          method="POST"
          action="{% url 'customer-requirements' %}"
          enctype="multipart/form-data"
        >
          {% csrf_token %}
          <input type="hidden" value="{{ customer.customer_id }}" name="cid" />

          <div class="row">
            <div class="col-md-6 form-section">
              <div class="form-group">
                <label for="cname">Company Name</label>
                <input
                  type="text"
                  class="form-control"
                  id="cname"
                  name="cname"
                  value=""
                />
              </div>
              <div class="form-group">
                <label for="pname">Project Name</label>
                <input
                  type="text"
                  class="form-control"
                  id="pname"
                  name="pname"
                  value=""
                />
              </div>
              <div class="form-group">
                <label for="Part_Name">Part Name</label>
                <input
                  type="text"
                  class="form-control"
                  id="Part_Name"
                  name="Part_Name"
                  value=""
                />
              </div>
              <div class="form-group">
                <label for="meal_preference">Category</label>
                <input
                  type="text"
                  class="form-control"
                  id="meal_preference"
                  name="meal_preference"
                  value=""
                />
              </div>
              <div class="form-group">
                <label for="email">Email</label>
                <input
                  type="text"
                  class="form-control"
                  id="email"
                  value="{{ customer.email }}"
                  name="email"
                />
              </div>
              <div class="form-group">
                <label for="pdf_file">Upload File</label>
                <input
                  type="file"
                  class="form-control"
                  id="pdf_file"
                  name="payable"
                />
              </div>
              <div class="form-group">
                <label for="cpno">Part Number</label>
                <input
                  type="text"
                  class="form-control"
                  id="cpno"
                  name="cpno"
                  value=""
                />
              </div>
              <div class="form-group">
                <label for="tv">Target Value</label>
                <input
                  type="number"
                  class="form-control"
                  id="tv"
                  name="tv"
                  value=""
                  required
                />
              </div>
            </div>

            <div class="col-md-6 form-section">
              <div class="form-group">
                <label for="desc">Description</label>
                <input
                  type="text"
                  class="form-control"
                  id="desc"
                  name="desc"
                  value=""
                  required
                />
              </div>
              <div class="form-group">
                <label for="special_instructions"
                  >Special Instructions or Comments</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="special_instructions"
                  name="blank_name"
                  value=""
                  required
                />
              </div>
              <div class="form-group">
                <label for="pr">Part Revision</label>
                <input
                  type="text"
                  class="form-control"
                  id="pr"
                  name="pr"
                  value=""
                  required
                />
              </div>
              <div class="form-group">
                <label for="phone_number">Phone number</label>
                <input
                  type="text"
                  class="form-control"
                  id="phone_number"
                  value="{{ customer.phno }}"
                  name="phone_number"
                  required
                />
              </div>
              <div class="form-group">
                <label for="av">Annual Volume</label>
                <input
                  type="number"
                  class="form-control"
                  id="av"
                  name="av"
                  value=""
                  required
                />
              </div>
              <div class="form-group">
                <label for="qs">Quote Submission</label>
                <input
                  type="date"
                  class="form-control"
                  id="qs"
                  name="qs"
                  required
                />
              </div>
              <div class="form-group">
                <label for="sop">Start of Production</label>
                <input
                  type="date"
                  class="form-control"
                  id="sop"
                  name="sop"
                  required
                />
              </div>
              <div class="form-group">
                <label for="status">Status</label>
                <select class="form-control" id="status" name="status">
                  <option value="working">Working</option>
                  <option value="pending">Pending</option>
                  {% if user.is_staff %}
                  <option value="completed">Completed</option>
                  {% endif %}
                </select>
              </div>
            </div>
          </div>

          <button type="submit" class="btn btn-primary">Save Changes</button>
          <button type="reset" class="btn btn-secondary">Reset</button>
        </form>
      </div>

      <div id="requirementsTableContainer" class="table-responsive">
        <table id="requirementsTable" class="table table-bordered">
          <thead class="thead-dark">
            <tr>
              <th class="project-id">Project ID</th>
              <th class="meal-preference">Meal Preference</th>
              <th class="part-name">Part Name</th>
              <th class="blank-name">Blank Name</th>
              <th>File</th>
              <th class="status">Status</th>
            </tr>
          </thead>
          <tbody class="list">
            {% for requirement in customer_requirements %}
            <tr>
              <td class="project-id">{{ requirement.project_id }}</td>
              <td class="meal-preference">{{ requirement.meal_preference }}</td>
              <td class="part-name">{{ requirement.Part_Name }}</td>
              <td class="blank-name">{{ requirement.blank_name }}</td>
              <td>
                {% if requirement.upload_file %}
                <a
                  href="{{ requirement.upload_file.url }}"
                  class="btn btn-sm btn-primary"
                  >Download</a
                >
                {% else %} No file {% endif %}
              </td>
              <td class="status">{{ requirement.status }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <!-- List.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/2.3.1/list.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var options = {
          valueNames: [
            "project-id",
            "meal-preference",
            "part-name",
            "blank-name",
            "status",
          ],
        };
        var requirementsTable = new List("requirementsTableContainer", options);

        // Toggle form display
        document
          .getElementById("newOrderBtn")
          .addEventListener("click", function () {
            document.getElementById("orderForm").style.display = "block";
            document.getElementById("cancelBtn").style.display = "inline-block";
            this.style.display = "none";
          });

        // Cancel form submission
        document
          .getElementById("cancelBtn")
          .addEventListener("click", function () {
            document.getElementById("orderForm").style.display = "none";
            document.getElementById("newOrderBtn").style.display =
              "inline-block";
            this.style.display = "none";
          });

        // AJAX form submission
        var form = document.getElementById("orderFormElement");
        form.addEventListener("submit", function (event) {
          event.preventDefault(); // Prevent default form submission

          var formData = new FormData(form);
          fetch(form.action, {
            method: "POST",
            body: formData,
          })
            .then((response) => {
              if (response.ok) {
                return response.json(); // assuming server returns JSON
              }
              throw new Error("Network response was not ok.");
            })
            .then((data) => {
              // Optionally handle success response
              console.log("Form submitted successfully:", data);
              form.reset(); // Reset the form
              document.getElementById("orderForm").style.display = "none";
              document.getElementById("newOrderBtn").style.display =
                "inline-block";
              document.getElementById("cancelBtn").style.display = "none";
              requirementsTable.add({
                "project-id": data.project_id,
                "meal-preference": data.meal_preference,
                "part-name": data.Part_Name,
                "blank-name": data.blank_name,
                status: data.status,
              });
            })
            .catch((error) => {
              console.error("Error occurred during form submission:", error);
              // Optionally display an error message to the user
            });
        });

        // Search functionality
        var searchInput = document.getElementById("searchInput");
        searchInput.addEventListener("keyup", function () {
          var searchString = searchInput.value.toLowerCase();
          requirementsTable.search(searchString);
        });
      });
    </script>
  </body>
</html>
{% comment %} hell {% endcomment %}
